<!DOCTYPE html><html lang="en"><head><title>Radim Řehůřek - Faster than Google? Optimization lessons in Python.</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"><link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/ui-lightness/jquery-ui.css"/><script src="http://code.jquery.com/jquery-2.1.4.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="../js/jquery-ui.js"></script><script src="../js/player.js"></script><script>if (document.location.hostname.search('videojots.com') !== -1) {(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-78294929-1', 'auto');ga('send', 'pageview');}</script><style>#segrip {width: 10px;height: 10px;background-color: #ffffff;border: 1px solid #000000;bottom: -5px;right: -5px;}</style></head><body><div style="margin: 0 auto;width:70%" ><div id="videoid" style="visibility: hidden">vU4TlwZzTfU</div><br/><ol class="breadcrumb"><li><a href="../">Home</a></li><li><a href="./" class="category">Data Science PyData</a></li><li class="active">Radim Řehůřek - Faster than Google? Optimization lessons in Python.</li></ol><div style=""><span class="videojots"><br/><span class="label label-danger">Click on text below to jump to the corresponding location in the video (except iOS)</span><br/><div id="control"><div id="playerBox"><div class="ui-resizable-handle ui-resizable-se" id="segrip"></div><div id="videoPlayer"></div></div><div class="Data Science PyData" id="advU4TlwZzTfU"></div></div><br/><br/><style scoped>.clickable{cursor:pointer;cursor:hand;}.clickable:hover{background:yellow;} .t{font-weight:bold;}.t:before{content:"\A";white-space: pre;}.t:after{content:"\A";white-space: pre;}</style><div  class="resizable"><br/><span class="clickable" id="63.644">We have Radim Rehurek. </span><span class="clickable" id="102.844"><br/><span class="t">Google's word2vec</span></span><span class="clickable" id="149.345">There is no manual input</span><span class="clickable" id="162.52"><br/>Unsupervised deep learning</span><span class="clickable" id="171.777"><br/>It needs a lot of data to do this</span><span class="clickable" id="202.319"><br/>This talk is about implementation</span><span class="clickable" id="233.233"><br/>The code is written in C, very optimized, but hard to read and optimize</span><span class="clickable" id="254.607"><br/>I ported it to Python to understand the code better. </span><span class="clickable" id="258.222"><span class="t">streaming (generator) for input</span></span><span class="clickable" id="263.49">I put a nicer interface. </span><span class="clickable" id="299.987">Connected to that, you can use the whole ecosystem of Python. </span><span class="clickable" id="358.961"><br/><span class="t">NumPy</span></span><span class="clickable" id="363.436">My port used NumPy which is the standard in the Python world. </span><span class="clickable" id="391.319">I was pretty happy with the result. </span><span class="clickable" id="400.585">But it was still 20 times slower than the C implementation. </span><span class="clickable" id="413.741"><br/><span class="t">Cython</span></span><span class="clickable" id="417.31">I had to translate some Python back to C. </span><span class="clickable" id="425.454">But it is a HPC application, tiny core which takes a lot of time and the rest doesn't consume much. </span><span class="clickable" id="444.44">After some profiling and debugging, I managed to match the speed of the C implementation. </span><span class="clickable" id="475.051"><br/><span class="t">BLAS</span></span><span class="clickable" id="482.014">Basic Linear Algebra Subroutines</span><span class="clickable" id="528.891"><br/>I translated the core routine into using these BLAS. </span><span class="clickable" id="566.399"><br/><span class="t">Benchmark</span></span><span class="clickable" id="588.507">Optimized NumPy can still be optimized by about two orders of magnitude. </span><span class="clickable" id="703.387"><br/><span class="t">Diagram explaining implementation</span></span><span class="clickable" id="777.408">The sentences come from a stream - there is no seeking to middle of sentences. </span><span class="clickable" id="818.386"><br/><span class="t">Worker threads</span></span><span class="clickable" id="863.554">The port has slightly better accuracy too. </span><span class="clickable" id="890.384"><br/><span class="t">not so good</span></span><span class="clickable" id="896.36">Cython memoryviews - did not perform as well as plain pointers. </span><span class="clickable" id="916.264"><br/>Cython's dynamic compliation doesn't work as expected</span><span class="clickable" id="964.292"><br/>BLAS idiosyncracies</span><span class="clickable" id="1055.138"><br/>Python 3 compatibility</span><span class="clickable" id="1080.039"><br/><span class="t">Conclusion slide</span></span><span class="clickable" id="1167.401"><span class="t">Questions</span></span><span class="clickable" id="1176.245"><span class="t">Memory usage - is this linear growth?</span></span><span class="clickable" id="1206.101">It takes about double the amount of memory. </span><span class="clickable" id="1243.312"><br/><span class="t">Have you tried numba?</span></span><span class="clickable" id="1322.071"><span class="t">Engineering performant code for deployment scenarios? Tradeoff between speed and maintainability?</span></span><span class="clickable" id="1348.645">The tradeoff I make is - depends on how much performance it gets. </span><span class="clickable" id="1476.276"><br/><span class="t">You mentioned gensim. Can you tell us more about it?</span></span><span class="clickable" id="1488.759">Gensim is a tool for large scale semantic modeling - I am the author. </span><span class="clickable" id="1546.179"><br/><span class="t">Correctness of the code - can you tell us about your test strategy?</span></span><span class="clickable" id="1578.149">It was a bit easier than usual academic papers. </span><span class="clickable" id="1590.349">We already had a reference implementation. </span><span class="clickable" id="1598.366">Testing can be done by comparing how it works with word2vec. </span><span class="clickable" id="1625.266">Mostly standard unit testing stuff. </span><br/><span style="font-size:xx-small;">Video outline created using <a href="http://www.videojots.com">VideoJots</a>. Click and drag lower right corner to resize video. On <a href="../ios_device.html">iOS devices</a> you cannot jump to video location by clicking on the outline. </span><br/></div></span></div></div></body></html>